<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>وضعیت واحدها | Daryanova Residence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "IRANSans", sans-serif;
      background: #020617;
      color: #e5e7eb;
      direction: rtl;
    }
    .wrapper {
      max-width: 520px;
      margin: 0 auto;
    }
    .card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 20px;
      padding: 18px 16px;
      border: 1px solid rgba(148,163,184,.4);
      box-shadow: 0 20px 50px rgba(0,0,0,.6);
    }
    h1 {
      margin: 0 0 4px;
      font-size: 18px;
      text-align: center;
    }
    .subtitle {
      font-size: 11px;
      text-align: center;
      color: #9ca3af;
      margin-bottom: 14px;
    }
    .legend {
      display: flex;
      justify-content: center;
      gap: 10px;
      font-size: 11px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }
    .dot-empty { background: #22c55e; }
    .dot-booked { background: #ef4444; }
    .dot-cleaning { background: #eab308; }

    .rooms {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .room-card {
      background: rgba(15,23,42,0.96);
      border-radius: 14px;
      padding: 10px 11px;
      border: 1px solid rgba(55,65,81,0.9);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .room-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }
    .room-name {
      font-size: 14px;
      font-weight: 600;
    }
    .status-badge {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .status-empty {
      background: rgba(22,163,74,0.18);
      color: #4ade80;
      border: 1px solid rgba(34,197,94,0.6);
    }
    .status-booked {
      background: rgba(248,113,113,0.12);
      color: #fca5a5;
      border: 1px solid rgba(248,113,113,0.6);
    }
    .status-cleaning {
      background: rgba(234,179,8,0.12);
      color: #fde68a;
      border: 1px solid rgba(234,179,8,0.6);
    }
    .status-unknown {
      background: rgba(148,163,184,0.12);
      color: #e5e7eb;
      border: 1px solid rgba(148,163,184,0.6);
    }
    .room-footer {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-top: 4px;
      gap: 8px;
      font-size: 11px;
      color: #9ca3af;
      flex-wrap: wrap;
    }
    .btn {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, #facc6b, #a16207);
      color: #111827;
      box-shadow: 0 8px 20px rgba(250,204,21,0.5);
    }
    .btn:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 4px 12px rgba(250,204,21,0.35);
    }
    .back-link {
      margin-top: 10px;
      text-align: center;
      font-size: 11px;
    }
    .back-link a {
      color: #facc6b;
      text-decoration: none;
    }
    .loading, .error {
      font-size: 12px;
      text-align: center;
      margin-bottom: 10px;
      color: #9ca3af;
    }
  </style>
</head>
<body>

<div class="wrapper">
  <div class="card">
    <h1>وضعیت واحدها</h1>
    <div class="subtitle">
      وضعیت واحدها براساس اطلاعات ثبت شده در سیستم مدیریت (Google Sheets)
    </div>

    <div class="legend">
      <div class="legend-item">
        <span class="dot dot-empty"></span><span>خالی</span>
      </div>
      <div class="legend-item">
        <span class="dot dot-booked"></span><span>رزرو شده</span>
      </div>
      <div class="legend-item">
        <span class="dot dot-cleaning"></span><span>نظافت</span>
      </div>
    </div>

    <div id="loading" class="loading">در حال دریافت اطلاعات واحدها...</div>
    <div id="error" class="error" style="display:none;"></div>

    <div id="roomsContainer" class="rooms"></div>

    <div class="back-link">
      بازگشت به <a href="index.html">صفحه اصلی</a>
    </div>
  </div>
</div>

<script>
  const SHEET_URL = "https://opensheet.elk.sh/1-5xWZOBhvfqMiNVhNM3MNNW5DO6Qklx76jo9MRZCpIk/Sheet1";

  function getStatusInfo(status) {
    const s = (status || "").trim().toLowerCase();
    if (s === "empty") return { label: "خالی", cls: "status-empty" };
    if (s === "booked") return { label: "رزرو شده", cls: "status-booked" };
    if (s === "cleaning") return { label: "نظافت", cls: "status-cleaning" };
    return { label: "نامشخص", cls: "status-unknown" };
  }

  function createWhatsAppLink(roomName) {
    const managerNumber = "989382382863"; // شماره واتساپ مدیریت (98+ شماره موبایل)
    const text = encodeURIComponent("\u0633\u0644\u0627\u0645\u060c \u0628\u0631\u0627\u06cc \u0631\u0632\u0631\u0648 " + roomName + " \u0627\u0637\u0644\u0627\u0639\u0627\u062a \u0645\u06cc\u200c\u062e\u0648\u0627\u0633\u062a\u0645.");
    return "https://wa.me/" + managerNumber + "?text=" + text;
  }

  const loadingEl = document.getElementById("loading");
  const errorEl = document.getElementById("error");
  const container = document.getElementById("roomsContainer");

  fetch(SHEET_URL)
    .then(res => res.json())
    .then(data => {
      loadingEl.style.display = "none";
      data.forEach(row => {
        const name = row.name ? row.name.trim() : "";
        const status = row.status ? row.status.trim() : "";
        if (!name) return;

        const sInfo = getStatusInfo(status);

        const card = document.createElement("div");
        card.className = "room-card";

        const header = document.createElement("div");
        header.className = "room-header";

        const nameDiv = document.createElement("div");
        nameDiv.className = "room-name";
        nameDiv.textContent = name;

        const statusBadge = document.createElement("div");
        statusBadge.className = "status-badge " + sInfo.cls;
        statusBadge.textContent = sInfo.label;

        header.appendChild(nameDiv);
        header.appendChild(statusBadge);

        const footer = document.createElement("div");
        footer.className = "room-footer";

        const btn = document.createElement("button");
        btn.className = "btn";
        btn.textContent = "درخواست رزرو " + name;
        btn.addEventListener("click", () => {
          window.location.href = createWhatsAppLink(name);
        });

        footer.appendChild(btn);

        card.appendChild(header);
        card.appendChild(footer);

        container.appendChild(card);
      });
    })
    .catch(err => {
      console.error(err);
      loadingEl.style.display = "none";
      errorEl.style.display = "block";
      errorEl.textContent = "\u062e\u0637\u0627 \u062f\u0631 \u062f\u0631\u06cc\u0627\u0641\u062a \u0627\u0637\u0644\u0627\u0639\u0627\u062a \u0627\u0632 \u0633\u06cc\u0633\u062a\u0645 \u0645\u062f\u06cc\u0631\u06cc\u062a. \u0644\u0637\u0641\u0627\u064b \u0628\u0639\u062f\u0627 \u062f\u0648\u0628\u0627\u0631\u0647 \u0627\u0645\u062a\u062d\u0627\u0646 \u06a9\u0646\u06cc\u062f.";
    });
</script>

</body>
</html>
